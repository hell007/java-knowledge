

## nginx 的几种分流方案

```
1、根据IP分流 
2、根据URL分流 
3、根据权重 
4、根据响应时间
```

### NGINX负载均衡分发请求的几种方式

1、轮询（默认） 
每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。 
2、weight 
指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。 
3、ip_hash 
每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。 
4、fair（第三方） 
按后端服务器的响应时间来分配请求，响应时间短的优先分配。 
5、url_hash（第三方） 
按访问url的hash结果来分配请求，使每个url定向到同一个后端服务器，后端服务器为缓存时比较有效。

```
upstream www.test1.com {  
    ip_hash;  
    server 172.16.125.76:8066 weight=10;  
    server 172.16.125.76:8077 down;  
    server 172.16.0.18:8066 max_fails=3 fail_timeout=30s;  
    server 172.16.0.18:8077 backup;  
} 

```

根据服务器的本身的性能差别及职能，可以设置不同的参数控制。 

```
down 表示负载过重或者不参与负载 
weight 权重过大代表承担的负载就越大 
backup 其它服务器down时才会请求backup服务器 
max_fails 失败超过指定次数会暂停或请求转往其它服务器 
fail_timeout 失败超过指定次数后暂停时间

```
