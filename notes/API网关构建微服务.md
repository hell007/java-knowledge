

## API网关构建微服务


##### 1.1 什么是API网关

API Gateway 是微服务架构体系中的一类型特殊服务，它是所有微服务的入口，它的职责是执行路由请求、协议转换、聚合数据、认证、限流、熔断等公共基础服务

![](./images/api-1.jpg)

从部署结构上说，上图是不采用API Gateway的微服务部署模式，我们可以清晰看到，
这种部署模式下，客户端与负载均衡器（一般是Nginx）直接交互，完成服务的调用。但这是这种模式下，也有它的不足。

```
不支持动态扩展，系统每多一个服务，就需要部署或修改负载均衡器。
无法做到动态的开关服务，若要下线某个服务，需要运维人员将服务地址从负载均衡器中移除。
对于API的限流，安全等控制，需要每个微服务去自己实现，增加了微服务的复杂性，同时也违反了微服务设计的单一职责原则。

```

Chris Richardson在http://microservices.io/中也提及到，在微服务的架构模式下，API Gateway是微服务架构中一个非常通用的模式，
利用API Gateway可以解决调用方如何调用独立的微服务这个问题。

![](./images/api-2.jpg)

上图为采用API Gateway模式，我们通过上图可以看到，API Gateway做为系统统一入口，实现了对各个微服务间的整合，同时又做到了对客户端友好，
屏蔽系统了复杂性和差异性。对比之前无API Gateway模式，API Gateway具有几个比较重要的优点：

```
采用API Gateway可以与微服务注册中心连接，实现微服务无感知动态扩容。
API Gateway对于无法访问的服务，可以做到自动熔断，无需人工参与。
API Gateway可以方便的实现蓝绿部署，金丝雀发布或A/B发布。
API Gateway做为系统统一入口，我们可以将各个微服务公共功能放在API Gateway中实现以尽可能减少各服务的职责。
帮助我们实现客户端的负载均衡策略。

```

##### 1.1 API的网关分类

Chris Richardson 在他的博客中把 API 网关划分为以下两种：

```
  单节点 API 网关
  Backends for frontends 网关（BFF模式）
  
```

单节点网关：单节点的 API网关为每个客户端提供不同的API，而不是提供一种万能风格的API。




